<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <script>

      window.onload = function() {
        var url = window.location.search.split('=');
        var directURL = url[1];

        canvasImageTest(directURL);

        function canvasImageTest(imageURL) {
          var canvas = document.getElementById("image-canvas");
          var ctx = canvas.getContext('2d');
          var img = new Image();
          img.crossOrigin = "anonymous";

          img.onload = function() {
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img,0,0);
            // ctx.fillStyle = "red";
            // ctx.fillRect(0,0,50,50);
            var imgd = ctx.getImageData(400, 400, 100, 100);
            var blockData = imgd["data"];
            console.log(ctx);
            console.log(blockData);
            console.log(getAvgBlockColor(blockData));
          }

          img.src = imageURL;
        } // end function

        function getAllBlockAverages(ctx, img) {
          var averagedBlocks = [];
          var width = img.width;
          var height = img.height;
          var avgBlockColor = "";
          var numBlocks = 50;
          var blockSize = 0;
          var numRows = 0;
          var numCols = 0;

          if (width > height) {
            blockSize = Math.floor(width / numBlocks);
            numCols = numBlocks;
            numRows = Math.floor(height / blockSize);
          } else {
            blockSize = Math.floor(height / numBlocks);
            numRows = numBlocks;
            numCols = Math.floor(width / blockSize);
          }

          for (var row = 0; row < numRows; row++) {

            for (var col = 0; col < numCols; col++) {
              var imgd = ctx.getImageData(row * blockSize, col * blockSize, blockSize, blockSize;
              var blockData = imgd["data"];
              avgBlockColor = getAvgBlockColor(blockData);
              averagedBlocks.push(avgBlockColor);
            }
          }
        } // end function

        function getAvgBlockColor(blockData) {
          var red = green = blue = i = count = 0;
          var length = blockData.length;
          console.log("length = ", length, i);

          while (i < length) {
            red   += blockData[i];
            green += blockData[i+1];
            blue  += blockData[i+2];
            i += 4; // skip a, get next red value
            count++;
          }

          red   = Math.floor(red / count);
          green = Math.floor(green / count);
          blue  = Math.floor(blue / count);

          if (red > 255 || green > 255 || blue > 255) {
            console.log("RGB value out of range");
          } else {
            return ((red << 16) | (green << 8) | blue).toString(16); // found online. Have no idea how it works.
          }
        } // end function
      }

    </script>
    <title>Pixelizr</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="css/materialize.min.css">
    <link rel="stylesheet" href="css/styles.css">
  </head>
  <body>
    <!-- <label>Image File:</label><br/>
    <input type="file" id="imageLoader" name="imageLoader"/> -->
    <canvas id="image-canvas"></canvas>
    <script src="js/jquery-2.2.4.min.js"></script>
  </body>
</html>
